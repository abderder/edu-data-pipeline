{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.2", "generated_at": "2025-04-21T00:02:23.745771Z", "invocation_id": "506e217a-b7df-4d97-99d0-511e555a3222", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:17.598803Z", "completed_at": "2025-04-21T00:02:17.679128Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:17.771067Z", "completed_at": "2025-04-21T00:02:19.574843Z"}], "thread_id": "Thread-1", "execution_time": 2.211937665939331, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2ab4-0003-d59a00014326"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_contacts", "compiled": true, "compiled_code": "WITH raw AS (\n    SELECT\n        \"Contact ID\" AS raw_contact_id,\n        \"First Name\" AS raw_first_name,\n        \"LastName\" AS raw_last_name,\n        \"phoneNumber\" AS raw_phone,\n        \"E-Mail\" AS email_1,\n        \"email\" AS email_2,\n        \"courriel\" AS email_3,\n        \"Mail\" AS email_4,\n        \"created_at\" AS raw_created_at\n    FROM EDU_DB.BRONZE.RAW_CONTACTS\n),\n\ncleaned AS (\n    SELECT\n        raw_contact_id AS contact_id,\n\n        INITCAP(TRIM(raw_first_name)) AS first_name,\n        INITCAP(TRIM(raw_last_name)) AS last_name,\n\n        TRIM(raw_phone) AS phone,\n\n        -- Priorit\u00e9 aux premiers emails non vides\n        COALESCE(\n            NULLIF(TRIM(LOWER(email_1)), ''),\n            NULLIF(TRIM(LOWER(email_2)), ''),\n            NULLIF(TRIM(LOWER(email_3)), ''),\n            NULLIF(TRIM(LOWER(email_4)), '')\n        ) AS email,\n\n        COALESCE(\n            TRY_TO_DATE(raw_created_at, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_created_at, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_created_at, 'YYYY/MM/DD'),\n            TRY_TO_DATE(raw_created_at, 'DD/MM/YYYY')\n        ) AS created_at\n\n    FROM raw\n    WHERE raw_contact_id IS NOT NULL\n)\n\nSELECT * FROM cleaned\nwhere contact_id IS NOT NULL AND email IS NOT NULL", "relation_name": "EDU_DB.SILVER.silver_contacts"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:17.621984Z", "completed_at": "2025-04-21T00:02:17.677458Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:17.762642Z", "completed_at": "2025-04-21T00:02:19.571799Z"}], "thread_id": "Thread-2", "execution_time": 2.229405403137207, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2514-0003-d59a00015216"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_courses", "compiled": true, "compiled_code": "WITH raw AS (\n    SELECT\n        \"CourseID\" AS raw_course_id,\n        \"Course Name\" AS raw_course_name,\n        \"credits\" AS raw_credits,\n        \"Start_Date\" AS raw_start_date,\n        \"endDate\" AS raw_end_date\n    FROM EDU_DB.BRONZE.RAW_COURSES\n),\n\ncleaned AS (\n    SELECT\n        CAST(raw_course_id AS INT) AS course_id,\n\n        -- Nettoyage du nom du cours (capitalisation, suppression espaces, etc.)\n        INITCAP(TRIM(raw_course_name)) AS course_name,\n\n        CAST(raw_credits AS INT) AS credits,\n\n        -- Formats de dates divers\n        COALESCE(\n            TRY_TO_DATE(raw_start_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_start_date, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_start_date, 'DD/MM/YYYY'),\n            TRY_TO_DATE(raw_start_date, 'YYYY/MM/DD')\n        ) AS start_date,\n\n        COALESCE(\n            TRY_TO_DATE(raw_end_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_end_date, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_end_date, 'DD/MM/YYYY'),\n            TRY_TO_DATE(raw_end_date, 'YYYY/MM/DD')\n        ) AS end_date\n\n    FROM raw\n    WHERE raw_course_id IS NOT NULL\n),\nranked AS (\n    SELECT *,\n        ROW_NUMBER() OVER (PARTITION BY course_id ORDER BY start_date DESC) AS row_num\n    FROM cleaned\n)\nSELECT\n    course_id,\n    course_name,\n    credits,\n    start_date,\n    end_date\nFROM ranked\nWHERE row_num = 1 and course_name is not null", "relation_name": "EDU_DB.SILVER.silver_courses"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:17.638085Z", "completed_at": "2025-04-21T00:02:17.670431Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:17.756211Z", "completed_at": "2025-04-21T00:02:19.996876Z"}], "thread_id": "Thread-3", "execution_time": 2.6073546409606934, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161aa"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_enrollments", "compiled": true, "compiled_code": "WITH raw AS (\n\n    SELECT\n        \"EnrollmentId\" AS raw_enrollment_id,\n        \"student_id\" AS raw_student_id,\n        \"Course ID\" AS raw_course_id,\n        \"EnrollDate\" AS raw_enroll_date,\n        \"Status\" AS raw_status\n    FROM EDU_DB.BRONZE.RAW_ENROLLMENTS\n\n), cleaned AS (\n\n    SELECT\n        raw_enrollment_id AS enrollment_id,\n        raw_student_id AS student_id,\n        CAST(raw_course_id AS INT) AS course_id,\n\n        COALESCE(\n            TRY_TO_DATE(raw_enroll_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_enroll_date, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_enroll_date, 'YYYY/MM/DD'),\n            TRY_TO_DATE(raw_enroll_date, 'DD/MM/YYYY')\n        ) AS enrollment_date,\n\n        -- Mapping plus pr\u00e9cis des statuts\n        CASE\n            WHEN LOWER(raw_status) IN ('active') THEN 'active'\n            WHEN LOWER(raw_status) IN ('done', 'valide', 'ok', 'completed') THEN 'completed'\n            WHEN LOWER(raw_status) IN ('cancelled', 'abandon', 'dropped', 'droped') THEN 'cancelled'\n            WHEN raw_status IS NULL OR TRIM(raw_status) = '' THEN 'unknown'\n            ELSE 'unknown'\n        END AS status\n\n    FROM raw\n    WHERE raw_enrollment_id IS NOT NULL\n)\n\nSELECT *, ROW_NUMBER() OVER (ORDER BY enrollment_id) AS enrollment_key FROM cleaned\nWHERE enrollment_id IS NOT NULL AND student_id IS NOT NULL AND course_id IS NOT NULL", "relation_name": "EDU_DB.SILVER.silver_enrollments"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:17.645536Z", "completed_at": "2025-04-21T00:02:17.668887Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:17.689217Z", "completed_at": "2025-04-21T00:02:20.227794Z"}], "thread_id": "Thread-4", "execution_time": 2.834415912628174, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2514-0003-d59a00015212"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_interactions", "compiled": true, "compiled_code": "WITH raw AS (\n    SELECT\n        \"InteractionId\" AS raw_interaction_id,\n        \"ContactId\" AS raw_contact_id,\n        \"Interaction Type\" AS raw_type,\n        \"Date\" AS raw_date,\n        \"Notes\" AS raw_notes\n    FROM EDU_DB.BRONZE.RAW_INTERACTIONS\n),\n\ncleaned AS (\n    SELECT\n        raw_interaction_id AS interaction_id,\n        raw_contact_id AS contact_id,\n        raw_notes,\n\n        -- Nettoyage du type d\u2019interaction\n        CASE\n            WHEN LOWER(raw_type) IN ('call', 'appel') THEN 'call'\n            WHEN LOWER(raw_type) IN ('meeting') THEN 'meeting'\n            WHEN LOWER(raw_type) IN ('rdv') THEN 'appointment'\n            WHEN LOWER(raw_type) IN ('email') THEN 'email'\n            ELSE 'unknown'\n        END AS interaction_type,\n\n        -- Gestion des dates multi-format\n        COALESCE(\n            TRY_TO_DATE(raw_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_date, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_date, 'DD/MM/YYYY'),\n            TRY_TO_DATE(raw_date, 'YYYY/MM/DD')\n        ) AS interaction_date\n\n    FROM raw\n    WHERE raw_interaction_id IS NOT NULL\n)\n\nSELECT * FROM cleaned\nwhere interaction_id IS NOT NULL AND contact_id IS NOT NULL", "relation_name": "EDU_DB.SILVER.silver_interactions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:19.812282Z", "completed_at": "2025-04-21T00:02:19.863514Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:19.873583Z", "completed_at": "2025-04-21T00:02:20.893863Z"}], "thread_id": "Thread-1", "execution_time": 1.2553067207336426, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2514-0003-d59a0001521a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_leads", "compiled": true, "compiled_code": "WITH raw AS (\n    SELECT\n        \"LeadID\" AS raw_lead_id,\n        \"Full Name\" AS raw_full_name,\n        \"Source\" AS raw_source,\n        \"Status\" AS raw_status,\n        \"CreatedDate\" AS raw_created_date\n    FROM EDU_DB.BRONZE.RAW_LEADS\n),\n\ncleaned AS (\n    SELECT\n        raw_lead_id AS lead_id,\n\n        INITCAP(TRIM(raw_full_name)) AS full_name,\n\n        -- Standardisation de la source\n        CASE\n            WHEN LOWER(raw_source) IN ('social', 'social media') THEN 'social'\n            WHEN LOWER(raw_source) IN ('web') THEN 'web'\n            WHEN LOWER(raw_source) IN ('email', 'e-mail') THEN 'email'\n            WHEN LOWER(raw_source) IN ('referral', 'referal') THEN 'referral'\n            ELSE 'unknown'\n        END AS source,\n\n        -- Standardisation du statut\n        CASE\n            WHEN LOWER(raw_status) = 'new' THEN 'new'\n            WHEN LOWER(raw_status) = 'qualified' THEN 'qualified'\n            WHEN LOWER(raw_status) = 'contacted' THEN 'contacted'\n            WHEN LOWER(raw_status) = 'lost' THEN 'lost'\n            ELSE 'unknown'\n        END AS status,\n\n        -- Parsing de la date\n        COALESCE(\n            TRY_TO_DATE(raw_created_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_created_date, 'DD-MM-YYYY'),\n            TRY_TO_DATE(raw_created_date, 'YYYY/MM/DD'),\n            TRY_TO_DATE(raw_created_date, 'DD/MM/YYYY')\n        ) AS created_date\n\n    FROM raw\n    WHERE raw_lead_id IS NOT NULL\n)\n\nSELECT * FROM cleaned\nwhere lead_id IS NOT NULL AND status IS NOT NULL AND source IS NOT NULL", "relation_name": "EDU_DB.SILVER.silver_leads"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:19.846359Z", "completed_at": "2025-04-21T00:02:19.896402Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:19.906131Z", "completed_at": "2025-04-21T00:02:21.076966Z"}], "thread_id": "Thread-2", "execution_time": 1.4184584617614746, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161ae"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.silver_students", "compiled": true, "compiled_code": "WITH raw AS (\n\n    SELECT\n        \"Student ID\"     AS raw_student_id,\n        \"FirstName\"      AS raw_first_name,\n        \"last_name\"      AS raw_last_name,\n        \"DOB\"            AS raw_dob,\n        \"reg_date\"       AS raw_reg_date,\n        \"email\"          AS email_1,\n        \"E-Mail\"         AS email_2,\n        \"mail\"           AS email_3,\n        \"courriel\"       AS email_4\n\n    FROM EDU_DB.BRONZE.RAW_STUDENTS\n\n), cleaned AS (\n\n    SELECT\n        raw_student_id AS student_id,\n\n        INITCAP(TRIM(raw_first_name)) AS first_name,\n        INITCAP(TRIM(raw_last_name))  AS last_name,\n\n        -- Normalisation de la date de naissance\n        COALESCE(\n            TRY_TO_DATE(raw_dob, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_dob, 'DD/MM/YYYY'),\n            TRY_TO_DATE(raw_dob, 'DD-MM-YYYY')\n        ) AS date_of_birth,\n\n        -- Normalisation de la date d'inscription\n        COALESCE(\n            TRY_TO_DATE(raw_reg_date, 'YYYY-MM-DD'),\n            TRY_TO_DATE(raw_reg_date, 'DD/MM/YYYY'),\n            TRY_TO_DATE(raw_reg_date, 'DD-MM-YYYY')\n        ) AS registration_date,\n\n        -- Choix du premier email disponible (priorit\u00e9 dans l'ordre)\n        COALESCE(NULLIF(TRIM(LOWER(email_1)), ''),\n                 NULLIF(TRIM(LOWER(email_2)), ''),\n                 NULLIF(TRIM(LOWER(email_3)), ''),\n                 NULLIF(TRIM(LOWER(email_4)), '')\n        ) AS email\n\n    FROM raw\n\n)\n\nSELECT * FROM cleaned\nWHERE student_id IS NOT NULL\nAND email IS NOT NULL", "relation_name": "EDU_DB.SILVER.silver_students"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:20.197850Z", "completed_at": "2025-04-21T00:02:20.258210Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:20.273030Z", "completed_at": "2025-04-21T00:02:21.206534Z"}], "thread_id": "Thread-3", "execution_time": 1.2308452129364014, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161b2"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.dim_contacts", "compiled": true, "compiled_code": "\n\nSELECT *\nFROM EDU_DB.SILVER.silver_contacts", "relation_name": "EDU_DB.GOLD.dim_contacts"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:20.462777Z", "completed_at": "2025-04-21T00:02:20.521752Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:20.532262Z", "completed_at": "2025-04-21T00:02:21.263314Z"}], "thread_id": "Thread-4", "execution_time": 1.0277538299560547, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2514-0003-d59a0001521e"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.dim_courses", "compiled": true, "compiled_code": "\n\nSELECT *,ROW_NUMBER() OVER (ORDER BY COURSE_ID) AS COURSE_KEY\nFROM EDU_DB.SILVER.silver_courses", "relation_name": "EDU_DB.GOLD.dim_courses"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:21.114014Z", "completed_at": "2025-04-21T00:02:21.154554Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:21.182562Z", "completed_at": "2025-04-21T00:02:22.226245Z"}], "thread_id": "Thread-1", "execution_time": 1.2716996669769287, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161b6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.dim_leads", "compiled": true, "compiled_code": "\n\nSELECT *\nFROM EDU_DB.SILVER.silver_leads", "relation_name": "EDU_DB.GOLD.dim_leads"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:21.354781Z", "completed_at": "2025-04-21T00:02:21.404538Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:21.427981Z", "completed_at": "2025-04-21T00:02:22.325816Z"}], "thread_id": "Thread-2", "execution_time": 1.1629719734191895, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161ba"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.dim_students", "compiled": true, "compiled_code": "\n\nSELECT *, ROW_NUMBER() OVER (ORDER BY STUDENT_ID) AS student_key\n\nFROM EDU_DB.SILVER.silver_students", "relation_name": "EDU_DB.GOLD.dim_students"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:21.572670Z", "completed_at": "2025-04-21T00:02:21.632853Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:21.641567Z", "completed_at": "2025-04-21T00:02:22.452712Z"}], "thread_id": "Thread-3", "execution_time": 1.0519378185272217, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2ab4-0003-d59a0001432a"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.fact_interactions", "compiled": true, "compiled_code": "\n\nSELECT\n    i.interaction_id,\n    i.contact_id,\n    c.first_name AS contact_first_name,\n    c.last_name AS contact_last_name,\n    c.email AS contact_email,\n    i.interaction_type,\n    i.interaction_date,\n    i.raw_notes AS notes\n\nFROM EDU_DB.SILVER.silver_interactions i\n\nLEFT JOIN EDU_DB.GOLD.dim_contacts c\n    ON i.contact_id = c.contact_id", "relation_name": "EDU_DB.GOLD.fact_interactions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-04-21T00:02:22.550652Z", "completed_at": "2025-04-21T00:02:22.582844Z"}, {"name": "execute", "started_at": "2025-04-21T00:02:22.589742Z", "completed_at": "2025-04-21T00:02:23.581499Z"}], "thread_id": "Thread-4", "execution_time": 1.1871998310089111, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bbd362-0106-2617-0003-d59a000161be"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.edu_dbt.fact_enrollments", "compiled": true, "compiled_code": "\n\nSELECT\n    e.enrollment_key,\n    s.student_key,\n    s.first_name AS student_first_name,\n    s.last_name AS student_last_name,\n    s.email AS student_email,\n\n    c.course_key,\n    c.course_name,\n    c.credits,\n\n    e.enrollment_date,\n    e.status\n\nFROM EDU_DB.SILVER.silver_enrollments e\n\nLEFT JOIN EDU_DB.GOLD.dim_students s\n    ON e.student_id = s.student_id\n\nLEFT JOIN EDU_DB.GOLD.dim_courses c\n    ON e.course_id = c.course_id", "relation_name": "EDU_DB.GOLD.fact_enrollments"}], "elapsed_time": 8.242920875549316, "args": {"enable_legacy_logger": false, "log_format": "default", "invocation_command": "dbt run --full-refresh --profiles-dir /opt/airflow/edu_dbt/profiles", "populate_cache": true, "use_colors_file": true, "defer": false, "full_refresh": true, "log_path": "/opt/airflow/edu_dbt/logs", "print": true, "write_json": true, "send_anonymous_usage_stats": true, "log_level": "info", "indirect_selection": "eager", "which": "run", "exclude": [], "warn_error_options": {"include": [], "exclude": []}, "profiles_dir": "/opt/airflow/edu_dbt/profiles", "log_level_file": "debug", "macro_debugging": false, "vars": {}, "partial_parse": true, "version_check": true, "static_parser": true, "log_file_max_bytes": 10485760, "strict_mode": false, "project_dir": "/opt/airflow/edu_dbt", "cache_selected_only": false, "log_format_file": "debug", "use_colors": true, "quiet": false, "introspect": true, "select": [], "show_resource_report": false, "partial_parse_file_diff": true, "printer_width": 80, "favor_state": false}}